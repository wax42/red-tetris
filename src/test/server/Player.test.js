import Player from "../../server/Player";
import Room from "../../server/Room";
const eventSocket = require("../../common/eventSocket");
import _ from "lodash";

const gridInit = [
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", "1", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", "1", "1", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", "1", ".", ".", ".", ".", "."]
];

const gridSpectrum = [
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", ".", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", "9", ".", ".", ".", ".", ".", "."],
  [".", ".", ".", "9", "9", ".", ".", ".", ".", "."],
  [".", ".", ".", "9", "9", ".", ".", ".", ".", "."]
];

describe("SERVER/PLAYER.JS - ", () => {
  const name = "player1";
  const spectrum = {
    playerName: name,
    score: 0,
    grid: _.cloneDeep(gridInit),
    lose: false
  };
  const mock = jest.fn();
  mock.mockReturnValue(spectrum);

  const cb = (msg, data) => {};

  const optionsGames = {
    invisibilityMode: false,
    spectrumMode: true
  };

  const on = (e, cb) => {
    if (e === eventSocket.START_GAME) cb(optionsGames);
    if (e === eventSocket.NEXT_PIECE) cb(gridInit);
    if (e === eventSocket.LINE_BREAK) cb(0);
    if (e === eventSocket.LOSE) cb();
  };

  const clientSocket = {
    id: "123",
    on,
    join: jest.fn(),
    leave: jest.fn(),
    emit: jest.fn(),
    to: () => {
      return {
        emit: jest.fn()
      };
    }
  };
  const room = new Room("room", name, clientSocket);
  room.newGame(optionsGames);

  it("should generate the spectrum", () => {
    const player = new Player(name, room, clientSocket);
    const spectrum = {
      playerName: name,
      score: 0,
      lose: true,
      grid: _.cloneDeep(gridSpectrum),
      nb_win: 0,
      spectator: false
    };
    expect(spectrum).toEqual(player.generateSpectrum(gridInit));
  });

  it("should creates players", () => {
    room.addPlayer("player2", clientSocket);

    room.game = null;
    room.addPlayer("player2", clientSocket);

    expect(true).toEqual(true);
    // expect(player.generateSpectrum).toHaveBeenCalled();
  });
});
